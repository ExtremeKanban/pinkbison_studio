======================================================================
PYTHON FILES FROM: C:\Users\hilto\pinkbison_studio\tests\unit\core
GENERATED: 01/20/2026 09:22:20
======================================================================

######################################################################
# FILE: C:\Users\hilto\pinkbison_studio\tests\unit\core\test_registry.py
# MODIFIED: 01/16/2026 20:31:05
######################################################################

"""
Test ProjectRegistry functionality.
"""

import pytest
from pathlib import Path
import shutil
from core.registry import ProjectRegistry


class TestProjectRegistry:
    """Test ProjectRegistry class"""
    
    def setup_method(self):
        """Create fresh registry for each test"""
        self.registry = ProjectRegistry()
        self.test_project = "test_registry_project"
    
    def teardown_method(self):
        """Clean up test project files"""
        # Remove test project directory
        test_dir = Path("project_state") / self.test_project
        if test_dir.exists():
            shutil.rmtree(test_dir)
        
        # Remove any legacy files
        for pattern in ["*.index", "*_memory*.json", "*_embeddings.npy"]:
            for file in Path(".").glob(f"{self.test_project}{pattern}"):
                file.unlink()
    
    def test_get_event_bus_creates_instance(self):
        """Verify get_event_bus creates EventBus"""
        bus = self.registry.get_event_bus(self.test_project)
        
        assert bus is not None
        assert bus.project_name == self.test_project
    
    def test_get_event_bus_reuses_instance(self):
        """Verify get_event_bus reuses same instance"""
        bus1 = self.registry.get_event_bus(self.test_project)
        bus2 = self.registry.get_event_bus(self.test_project)
        
        assert bus1 is bus2
    
    def test_get_audit_log_creates_instance(self):
        """Verify get_audit_log creates AuditLog"""
        log = self.registry.get_audit_log(self.test_project)
        
        assert log is not None
        assert log.project_name == self.test_project
    
    def test_get_memory_store_creates_instance(self):
        """Verify get_memory_store creates MemoryStore"""
        memory = self.registry.get_memory_store(self.test_project)
        
        assert memory is not None
        assert memory.project_name == self.test_project
    
    def test_get_graph_store_creates_instance(self):
        """Verify get_graph_store creates GraphStore"""
        graph = self.registry.get_graph_store(self.test_project)
        
        assert graph is not None
        assert graph.project_name == self.test_project
    
    def test_get_task_manager_creates_instance(self):
        """Verify get_task_manager creates TaskManager"""
        tasks = self.registry.get_task_manager(self.test_project)
        
        assert tasks is not None
        assert tasks.project_name == self.test_project
    
    def test_clear_project_removes_instances(self):
        """Verify clear_project removes all instances"""
        # Create instances
        self.registry.get_event_bus(self.test_project)
        self.registry.get_audit_log(self.test_project)
        self.registry.get_memory_store(self.test_project)
        
        # Verify they exist
        assert self.test_project in self.registry._event_buses
        assert self.test_project in self.registry._audit_logs
        assert self.test_project in self.registry._memory_stores
        
        # Clear project
        self.registry.clear_project(self.test_project)
        
        # Verify removed
        assert self.test_project not in self.registry._event_buses
        assert self.test_project not in self.registry._audit_logs
        assert self.test_project not in self.registry._memory_stores
    
    def test_get_all_projects(self):
        """Verify get_all_projects returns project list"""
        # Create instances for multiple projects
        self.registry.get_event_bus("project1")
        self.registry.get_audit_log("project2")
        self.registry.get_memory_store("project3")
        
        projects = self.registry.get_all_projects()
        
        assert "project1" in projects
        assert "project2" in projects
        assert "project3" in projects
    
    def test_project_isolation(self):
        """Verify projects are isolated from each other"""
        bus1 = self.registry.get_event_bus("project_a")
        bus2 = self.registry.get_event_bus("project_b")
        
        # Should be different instances
        assert bus1 is not bus2
        assert bus1.project_name == "project_a"
        assert bus2.project_name == "project_b"

----------------------------------------------------------------------

######################################################################
# FILE: C:\Users\hilto\pinkbison_studio\tests\unit\core\__init__.py
# MODIFIED: 01/16/2026 20:30:48
######################################################################

# Empty file for package recognition

----------------------------------------------------------------------

======================================================================
SUMMARY: 2 files combined
======================================================================
