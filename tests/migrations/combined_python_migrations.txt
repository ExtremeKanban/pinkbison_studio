======================================================================
PYTHON FILES FROM: C:\Users\hilto\pinkbison_studio\tests\migrations
GENERATED: 01/20/2026 11:36:34
======================================================================

######################################################################
# FILE: C:\Users\hilto\pinkbison_studio\tests\migrations\test_phase_0_migration.py
# MODIFIED: 01/16/2026 12:39:21
######################################################################

"""
Quick test script to verify Phase 0 migration.
Run this after applying all file changes.
"""

import sys
from pathlib import Path

def test_imports():
    """Test that all new modules import correctly"""
    print("Testing imports...")
    
    try:
        from core.event_bus import EventBus, Event
        from core.audit_log import AuditLog, AuditEntry
        from core.project_state import ProjectState, ProjectMeta
        from core.agent_factory import AgentFactory
        print("âœ“ Core modules import successfully")
    except ImportError as e:
        print(f"âœ— Import failed: {e}")
        return False
    
    try:
        from agents.base_agent import AgentBase
        from agents.producer import ProducerAgent
        print("âœ“ Agent modules import successfully")
    except ImportError as e:
        print(f"âœ— Import failed: {e}")
        return False
    
    return True


def test_event_bus():
    """Test EventBus functionality"""
    print("\nTesting EventBus...")
    
    from core.event_bus import EventBus
    
    bus = EventBus("test_project")
    
    # Publish event
    event = bus.publish(
        sender="agent_a",
        recipient="agent_b",
        event_type="test_message",
        payload={"content": "Hello"}
    )
    
    # Retrieve event
    recent = bus.get_recent("agent_b", limit=1)
    
    if len(recent) == 1 and recent[0].payload["content"] == "Hello":
        print("âœ“ EventBus working correctly")
        return True
    else:
        print("âœ— EventBus test failed")
        return False


def test_audit_log():
    """Test AuditLog functionality"""
    print("\nTesting AuditLog...")
    
    from core.audit_log import AuditLog
    import os
    
    # Create test log
    log = AuditLog("test_project")
    
    # Append entry
    log.append(
        event_type="test_event",
        sender="test_sender",
        recipient="test_recipient",
        payload={"test": "data"}
    )
    
    # Read entries
    entries = log.read_all()
    
    # Cleanup
    log_path = Path("audit_logs/test_project_audit.jsonl")
    if log_path.exists():
        log_path.unlink()
    
    if len(entries) == 1 and entries[0].payload["test"] == "data":
        print("âœ“ AuditLog working correctly")
        return True
    else:
        print("âœ— AuditLog test failed")
        return False


def test_project_state():
    """Test ProjectState functionality"""
    print("\nTesting ProjectState...")
    
    from core.project_state import ProjectState
    import shutil
    
    # Create state
    state = ProjectState.create_default("test_project")
    state.outline = "Test outline"
    state.save()
    
    # Load state
    loaded = ProjectState.load("test_project")
    
    # Cleanup
    test_dir = Path("project_state/test_project")
    if test_dir.exists():
        shutil.rmtree(test_dir)
    
    if loaded.outline == "Test outline":
        print("âœ“ ProjectState working correctly")
        return True
    else:
        print("âœ— ProjectState test failed")
        return False


def test_agent_factory():
    """Test AgentFactory functionality"""
    print("\nTesting AgentFactory...")
    
    from core.agent_factory import AgentFactory
    from core.event_bus import EventBus
    from core.audit_log import AuditLog
    
    bus = EventBus("test_project")
    log = AuditLog("test_project")
    
    factory = AgentFactory(
        project_name="test_project",
        event_bus=bus,
        audit_log=log,
        fast_model_url="http://localhost:8000/v1/chat/completions",
        model_mode="fast"
    )
    
    # Create agent
    agent = factory.create_plot_architect()
    
    # Cleanup
    log_path = Path("audit_logs/test_project_audit.jsonl")
    if log_path.exists():
        log_path.unlink()
    
    if agent.name == "plot_architect":
        print("âœ“ AgentFactory working correctly")
        return True
    else:
        print("âœ— AgentFactory test failed")
        return False


def main():
    """Run all tests"""
    print("="*50)
    print("Phase 0 Migration Test Suite")
    print("="*50)
    
    tests = [
        test_imports,
        test_event_bus,
        test_audit_log,
        test_project_state,
        test_agent_factory,
    ]
    
    results = []
    for test in tests:
        try:
            results.append(test())
        except Exception as e:
            print(f"âœ— Test crashed: {e}")
            results.append(False)
    
    print("\n" + "="*50)
    print(f"Results: {sum(results)}/{len(results)} tests passed")
    print("="*50)
    
    if all(results):
        print("\nâœ“ All tests passed! Migration successful.")
        return 0
    else:
        print("\nâœ— Some tests failed. Check output above.")
        return 1


if __name__ == "__main__":
    sys.exit(main())

----------------------------------------------------------------------

======================================================================
SUMMARY: 1 files combined
======================================================================
